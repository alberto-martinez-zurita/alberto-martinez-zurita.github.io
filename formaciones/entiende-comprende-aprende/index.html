<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLARITY - Gestión Estratégica de Deuda Técnica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar-icon {
            width: 24px;
            height: 24px;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex h-screen">
        <!-- Sidebar de Navegación -->
        <aside class="w-64 bg-white shadow-md flex flex-col">
            <div class="p-4 border-b">
                <h1 class="text-2xl font-bold text-gray-900">CLAR Model</h1>
                <p class="text-xs text-gray-500">Gestión de Deuda Técnica</p>
            </div>
            <nav class="flex-grow p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="#/dashboard" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded-md transition-colors">
                            <svg class="sidebar-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#/applications" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded-md transition-colors">
                            <svg class="sidebar-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c.225-.01.447-.02.674-.028a1.5 1.5 0 01.04 2.992H9.75v-.632zM9.75 3.104a1.125 1.125 0 011.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v5.714a2.25 2.25 0 01-.659 1.591L11.5 14.5M14.25 9h3.75M14.25 12h3.75M14.25 15h3.75M14.25 18h3.75M17.25 21h-9.75a2.25 2.25 0 01-2.25-2.25v-13.5A2.25 2.25 0 017.5 3h9.75a2.25 2.25 0 012.25 2.25v13.5a2.25 2.25 0 01-2.25 2.25z" /></svg>
                            <span>Aplicaciones</span>
                        </a>
                    </li>
                    <li>
                        <a href="#/products" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded-md transition-colors">
                            <svg class="sidebar-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>
                            <span>Productos</span>
                        </a>
                    </li>
                    <li>
                        <a href="#/servers" class="flex items-center p-2 text-gray-700 hover:bg-gray-200 rounded-md transition-colors">
                            <svg class="sidebar-icon mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M5.25 14.25h13.5m-13.5 0a3 3 0 01-3-3V7.5a3 3 0 013-3h13.5a3 3 0 013 3v3.75a3 3 0 01-3 3M5.25 14.25v-3.75m13.5-3.75v3.75m0-3.75a3 3 0 013 3V7.5a3 3 0 00-3-3h-13.5a3 3 0 00-3 3v3.75a3 3 0 003 3m-3-3h13.5" /></svg>
                            <span>Servidores</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Contenido Principal -->
        <main id="main-content" class="flex-1 p-6 md:p-10 overflow-y-auto">
            <!-- El contenido se renderizará aquí dinámicamente -->
        </main>
    </div>

    <script>
        // --- MOCK DATA ---
        // Basado en los documentos proporcionados.
        const mockData = {
            products: [
                { id: 'p1', name: 'Core Banking API', description: 'API central para operaciones bancarias transaccionales.', strategy: 'Inversión Estratégica' },
                { id: 'p2', name: 'Gateway de Pagos Móviles', description: 'Procesa pagos desde dispositivos móviles.', strategy: 'Mantener y Optimizar' },
                { id: 'p3', name: 'Plataforma de Analítica', description: 'Motor de análisis de datos de clientes.', strategy: 'Inversión Estratégica' },
                { id: 'p4', name: 'CRM Interno', description: 'Sistema de gestión de relaciones con clientes.', strategy: 'Desmantelar' },
            ],
            applications: [
                { id: 'app1', name: 'App Banca Móvil', owner: 'Equipo Digital', products: ['p1', 'p2'], tdr: 12.5 },
                { id: 'app2', name: 'Portal Banca Online', owner: 'Equipo Web', products: ['p1', 'p3'], tdr: 8.2 },
                { id: 'app3', name: 'Sistema de Préstamos', owner: 'Equipo de Crédito', products: ['p1', 'p4'], tdr: 22.8 },
                { id: 'app4', name: 'Dashboard de Riesgos', owner: 'Equipo de Riesgos', products: ['p3'], tdr: 5.1 },
                { id: 'app5', name: 'Herramienta de Marketing', owner: 'Equipo de Marketing', products: ['p3', 'p4'], tdr: 18.0 },
            ],
            servers: [
                { id: 'srv1', name: 'app-prod-01', ownerApp: 'app1', artifacts: ['mobile-banking-api-v3.1.jar', 'auth-service-v1.2.war'] },
                { id: 'srv2', name: 'web-prod-cluster-a', ownerApp: 'app2', artifacts: ['online-portal-v5.4.ear'] },
                { id: 'srv3', name: 'loan-proc-01', ownerApp: 'app3', artifacts: ['loan-engine-v1.8.jar', 'legacy-connector.jar'] },
                { id: 'srv4', name: 'analytics-worker-01', ownerApp: 'app4', artifacts: ['risk-calculator-v2.0.py'] },
                { id: 'srv5', name: 'analytics-worker-02', ownerApp: 'app4', artifacts: ['risk-dashboard-fe.js'] },
            ],
            technicalDebt: [
                { id: 'td1', appId: 'app3', description: 'Uso de un protocolo de mensajería propietario y no estándar.', level: 'Arquitectónico', cycle: 'Diseño', probability: 3, impact: 5, aims: ['Future-proofing', 'Coste'] },
                { id: 'td2', appId: 'app2', description: 'Reglas de negocio codificadas directamente en la capa de UI.', level: 'Código', cycle: 'Desarrollo', probability: 5, impact: 3, aims: ['Coste', 'Alineamiento Estratégico'] },
                { id: 'td3', appId: 'app1', description: 'Proceso de despliegue manual que requiere 8h de inactividad.', level: 'Infraestructura', cycle: 'Mantenimiento', probability: 5, impact: 5, aims: ['Calidad', 'Coste'] },
                { id: 'td4', appId: 'app4', description: 'Cobertura de pruebas unitarias del módulo de informes es solo del 40%.', level: 'Pruebas', cycle: 'Sprint 14', probability: 4, impact: 3, aims: ['Coste', 'Calidad'] },
                { id: 'td5', appId: 'app3', description: 'Dependencia obsoleta (Struts 1.x) con vulnerabilidad crítica conocida.', level: 'Seguridad', cycle: 'Desarrollo', probability: 5, impact: 5, aims: ['Calidad', 'Alineamiento Estratégico'] },
                { id: 'td6', appId: 'app5', description: 'Documentación de API ausente para endpoints de clientes.', level: 'Documentación', cycle: 'Desarrollo', probability: 2, impact: 4, aims: ['Future-proofing'] },
                { id: 'td7', appId: 'app1', description: 'El módulo de autenticación tiene una complejidad ciclomática de 52.', level: 'Código', cycle: 'Desarrollo', probability: 4, impact: 4, aims: ['Calidad', 'Coste'] },
                { id: 'td8', appId: 'app2', description: 'Inconsistencia de configuración entre entornos de Staging y Producción.', level: 'Infraestructura', cycle: 'Mantenimiento', probability: 4, impact: 3, aims: ['Calidad'] },
            ]
        };

        // --- HELPERS ---
        const getAppById = (id) => mockData.applications.find(a => a.id === id);
        const getProductById = (id) => mockData.products.find(p => p.id === id);
        const getServerById = (id) => mockData.servers.find(s => s.id === id);
        const getDebtById = (id) => mockData.technicalDebt.find(td => td.id === id);

        const riskScore = (p, i) => p * i;
        const riskColor = (score) => {
            if (score > 15) return 'bg-red-500';
            if (score > 8) return 'bg-yellow-500';
            return 'bg-green-500';
        };

        const levelColor = (level) => {
            const colors = {
                'Arquitectónico': 'bg-red-200 text-red-800',
                'Código': 'bg-blue-200 text-blue-800',
                'Infraestructura': 'bg-indigo-200 text-indigo-800',
                'Pruebas': 'bg-green-200 text-green-800',
                'Seguridad': 'bg-pink-200 text-pink-800',
                'Documentación': 'bg-gray-200 text-gray-800',
            };
            return colors[level] || 'bg-gray-200 text-gray-800';
        }
        
        // --- RENDER FUNCTIONS ---
        const contentContainer = document.getElementById('main-content');

        const renderDashboard = () => {
            const totalTDR = mockData.applications.reduce((acc, app) => acc + app.tdr, 0) / mockData.applications.length;
            const debtByLevel = mockData.technicalDebt.reduce((acc, item) => {
                acc[item.level] = (acc[item.level] || 0) + 1;
                return acc;
            }, {});
            const topRiskDebt = [...mockData.technicalDebt].sort((a, b) => riskScore(b.probability, b.impact) - riskScore(a.probability, a.impact)).slice(0, 5);

            contentContainer.innerHTML = `
                <div class="space-y-8">
                    <h2 class="text-3xl font-bold">Dashboard Ejecutivo</h2>
                    
                    <!-- KPIs -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-gray-500">TDR Promedio del Portfolio</h3>
                            <p class="text-4xl font-bold mt-2">${totalTDR.toFixed(1)}%</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-gray-500">Aplicaciones Monitoreadas</h3>
                            <p class="text-4xl font-bold mt-2">${mockData.applications.length}</p>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-gray-500">Items de Deuda Críticos (Risk > 15)</h3>
                            <p class="text-4xl font-bold mt-2">${mockData.technicalDebt.filter(d => riskScore(d.probability, d.impact) > 15).length}</p>
                        </div>
                    </div>

                    <!-- Charts -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-semibold mb-4">Deuda Técnica por Nivel (Level)</h3>
                            <div class="space-y-3">
                                ${Object.entries(debtByLevel).map(([level, count]) => `
                                    <div class="flex items-center">
                                        <span class="w-28 text-sm font-medium">${level}</span>
                                        <div class="w-full bg-gray-200 rounded-full h-4">
                                            <div class="h-4 rounded-full ${levelColor(level).split(' ')[0]}" style="width: ${count/mockData.technicalDebt.length * 100}%"></div>
                                        </div>
                                        <span class="ml-3 text-sm font-medium">${count}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-semibold mb-4">Top 5 Items de Deuda por Riesgo</h3>
                            <ul class="space-y-2">
                                ${topRiskDebt.map(d => `
                                    <li class="flex items-center justify-between p-2 hover:bg-gray-50 rounded">
                                        <a href="#/debt/${d.id}" class="truncate text-sm text-blue-600 hover:underline">${d.description}</a>
                                        <div class="flex items-center">
                                            <span class="text-xs font-bold mr-2 text-gray-600">Risk: ${riskScore(d.probability, d.impact)}</span>
                                            <div class="w-4 h-4 rounded-full ${riskColor(riskScore(d.probability, d.impact))}"></div>
                                        </div>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderApplications = () => {
            contentContainer.innerHTML = `
                <h2 class="text-3xl font-bold mb-6">Aplicaciones</h2>
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="p-4 text-left text-xs font-semibold text-gray-600 uppercase">Nombre</th>
                                <th class="p-4 text-left text-xs font-semibold text-gray-600 uppercase">Propietario</th>
                                <th class="p-4 text-left text-xs font-semibold text-gray-600 uppercase">TDR</th>
                                <th class="p-4 text-left text-xs font-semibold text-gray-600 uppercase">Items de Deuda</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${mockData.applications.map(app => `
                                <tr class="hover:bg-gray-50">
                                    <td class="p-4"><a href="#/application/${app.id}" class="font-medium text-blue-600 hover:underline">${app.name}</a></td>
                                    <td class="p-4 text-gray-600">${app.owner}</td>
                                    <td class="p-4 font-semibold ${app.tdr > 15 ? 'text-red-600' : app.tdr > 10 ? 'text-yellow-600' : 'text-green-600'}">${app.tdr}%</td>
                                    <td class="p-4 text-gray-600">${mockData.technicalDebt.filter(d => d.appId === app.id).length}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        };
        
        const renderApplicationDetail = (id) => {
            const app = getAppById(id);
            if (!app) {
                contentContainer.innerHTML = `<p>Aplicación no encontrada.</p>`;
                return;
            }
            const appDebt = mockData.technicalDebt.filter(d => d.appId === app.id);
            const appServers = mockData.servers.filter(s => s.ownerApp === app.id);
            const appProducts = mockData.products.filter(p => app.products.includes(p.id));
            const debtByLevel = appDebt.reduce((acc, item) => {
                acc[item.level] = (acc[item.level] || 0) + 1;
                return acc;
            }, {});

            contentContainer.innerHTML = `
                <div class="space-y-8">
                    <div>
                        <a href="#/applications" class="text-sm text-blue-600 hover:underline">&larr; Volver a Aplicaciones</a>
                        <h2 class="text-3xl font-bold mt-2">${app.name}</h2>
                        <p class="text-gray-500">Propietario: ${app.owner}</p>
                    </div>

                    <!-- CLAR Dashboard para la App -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                         <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-semibold mb-4">Deuda por Nivel (Level)</h3>
                             <div class="space-y-3">
                                ${Object.keys(debtByLevel).length > 0 ? Object.entries(debtByLevel).map(([level, count]) => `
                                    <div class="flex items-center">
                                        <span class="w-28 text-sm font-medium">${level}</span>
                                        <div class="w-full bg-gray-200 rounded-full h-4">
                                            <div class="h-4 rounded-full ${levelColor(level).split(' ')[0]}" style="width: ${count/appDebt.length * 100}%"></div>
                                        </div>
                                        <span class="ml-3 text-sm font-medium">${count}</span>
                                    </div>
                                `).join('') : '<p class="text-sm text-gray-500">No hay deuda técnica registrada.</p>'}
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="font-semibold mb-4">Deuda por Riesgo (Risk)</h3>
                            <div class="flex justify-around items-center h-full">
                                <div class="text-center">
                                    <p class="text-4xl font-bold text-red-600">${appDebt.filter(d => riskScore(d.probability, d.impact) > 15).length}</p>
                                    <p class="text-sm text-gray-500">Crítico</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-4xl font-bold text-yellow-600">${appDebt.filter(d => riskScore(d.probability, d.impact) > 8 && riskScore(d.probability, d.impact) <= 15).length}</p>
                                    <p class="text-sm text-gray-500">Alto</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-4xl font-bold text-green-600">${appDebt.filter(d => riskScore(d.probability, d.impact) <= 8).length}</p>
                                    <p class="text-sm text-gray-500">Bajo</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Items de Deuda Técnica -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <h3 class="text-lg font-semibold p-4 border-b">Items de Deuda Técnica (${appDebt.length})</h3>
                        ${appDebt.length > 0 ? `
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Descripción</th>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Nivel</th>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Ciclo</th>
                                    <th class="p-3 text-left text-xs font-semibold text-gray-600 uppercase">Riesgo</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${appDebt.map(d => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="p-3"><a href="#/debt/${d.id}" class="text-sm text-blue-600 hover:underline">${d.description}</a></td>
                                        <td class="p-3"><span class="text-xs font-semibold px-2 py-1 rounded-full ${levelColor(d.level)}">${d.level}</span></td>
                                        <td class="p-3 text-sm text-gray-600">${d.cycle}</td>
                                        <td class="p-3">
                                            <div class="flex items-center">
                                                <div class="w-4 h-4 rounded-full ${riskColor(riskScore(d.probability, d.impact))}"></div>
                                                <span class="ml-2 text-sm font-semibold">${riskScore(d.probability, d.impact)}</span>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        ` : '<p class="p-4 text-sm text-gray-500">No hay deuda técnica registrada para esta aplicación.</p>'}
                    </div>

                    <!-- Información Cruzada -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow">
                            <h3 class="text-lg font-semibold p-4 border-b">Productos Utilizados</h3>
                            <ul class="divide-y divide-gray-200 p-4">
                                ${appProducts.map(p => `
                                    <li class="py-2"><a href="#/product/${p.id}" class="text-sm text-blue-600 hover:underline">${p.name}</a></li>
                                `).join('')}
                            </ul>
                        </div>
                         <div class="bg-white rounded-lg shadow">
                            <h3 class="text-lg font-semibold p-4 border-b">Servidores Propietarios</h3>
                            <ul class="divide-y divide-gray-200 p-4">
                                ${appServers.map(s => `
                                    <li class="py-2"><a href="#/server/${s.id}" class="text-sm text-blue-600 hover:underline">${s.name}</a></li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        };
        
        const renderDebtDetail = (id) => {
            const debt = getDebtById(id);
            if(!debt) {
                 contentContainer.innerHTML = `<p>Item de deuda no encontrado.</p>`;
                 return;
            }
            const app = getAppById(debt.appId);
            const score = riskScore(debt.probability, debt.impact);

            contentContainer.innerHTML = `
                <div class="space-y-6">
                    <div>
                        <a href="#/application/${app.id}" class="text-sm text-blue-600 hover:underline">&larr; Volver a la Aplicación ${app.name}</a>
                        <h2 class="text-3xl font-bold mt-2">Detalle de Deuda Técnica</h2>
                    </div>

                    <div class="bg-white p-6 rounded-lg shadow">
                        <p class="text-lg">${debt.description}</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-sm font-semibold text-gray-500 mb-2">Aplicación Afectada</h3>
                            <a href="#/application/${app.id}" class="text-xl font-bold text-blue-600 hover:underline">${app.name}</a>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-sm font-semibold text-gray-500 mb-2">Objetivos (Aims) Impactados</h3>
                             <div class="flex flex-wrap gap-2">
                                ${debt.aims.map(aim => `<span class="text-xs font-semibold px-2 py-1 rounded-full bg-teal-200 text-teal-800">${aim}</span>`).join('')}
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-sm font-semibold text-gray-500 mb-2">Ciclo de Origen (Cycle)</h3>
                            <p class="text-xl font-bold">${debt.cycle}</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-sm font-semibold text-gray-500 mb-2">Nivel (Level)</h3>
                             <span class="text-md font-semibold px-3 py-1.5 rounded-full ${levelColor(debt.level)}">${debt.level}</span>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-sm font-semibold text-gray-500 mb-2">Evaluación de Riesgo (Risk)</h3>
                            <div class="flex items-center space-x-4">
                                <div>
                                    <p class="text-sm">Probabilidad: <span class="font-bold">${debt.probability}/5</span></p>
                                    <p class="text-sm">Impacto: <span class="font-bold">${debt.impact}/5</span></p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm">Puntuación Total</p>
                                    <div class="w-16 h-16 rounded-full ${riskColor(score)} flex items-center justify-center text-white text-2xl font-bold">
                                        ${score}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderProducts = () => {
             contentContainer.innerHTML = `
                <h2 class="text-3xl font-bold mb-6">Productos</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${mockData.products.map(p => `
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="font-bold text-lg text-blue-700"><a href="#/product/${p.id}">${p.name}</a></h3>
                            <p class="text-sm text-gray-600 mt-2">${p.description}</p>
                            <div class="mt-4">
                                <span class="text-xs font-semibold px-2 py-1 rounded-full bg-purple-200 text-purple-800">${p.strategy}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        };

        const renderProductDetail = (id) => {
            const product = getProductById(id);
            if (!product) {
                contentContainer.innerHTML = `<p>Producto no encontrado.</p>`;
                return;
            }
            const consumingApps = mockData.applications.filter(app => app.products.includes(id));
            contentContainer.innerHTML = `
                 <div>
                    <a href="#/products" class="text-sm text-blue-600 hover:underline">&larr; Volver a Productos</a>
                    <h2 class="text-3xl font-bold mt-2">${product.name}</h2>
                    <p class="text-gray-600 mt-1">${product.description}</p>
                    <div class="mt-4">
                        <span class="text-sm font-semibold px-3 py-1.5 rounded-full bg-purple-200 text-purple-800">${product.strategy}</span>
                    </div>
                </div>
                <div class="mt-8 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold p-4 border-b">Aplicaciones que consumen este producto</h3>
                     <ul class="divide-y divide-gray-200 p-4">
                        ${consumingApps.map(app => `
                            <li class="py-3"><a href="#/application/${app.id}" class="font-medium text-blue-600 hover:underline">${app.name}</a> <span class="text-sm text-gray-500"> - Propietario: ${app.owner}</span></li>
                        `).join('')}
                    </ul>
                </div>
            `;
        };
        
        const renderServers = () => {
            contentContainer.innerHTML = `
                <h2 class="text-3xl font-bold mb-6">Servidores</h2>
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="p-4 text-left text-xs font-semibold text-gray-600 uppercase">Nombre Servidor</th>
                                <th class="p-4 text-left text-xs font-semibold text-gray-600 uppercase">Aplicación Propietaria</th>
                                <th class="p-4 text-left text-xs font-semibold text-gray-600 uppercase">Artefactos Desplegados</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${mockData.servers.map(server => {
                                const ownerApp = getAppById(server.ownerApp);
                                return `
                                <tr class="hover:bg-gray-50">
                                    <td class="p-4"><a href="#/server/${server.id}" class="font-medium text-blue-600 hover:underline">${server.name}</a></td>
                                    <td class="p-4 text-gray-600"><a href="#/application/${ownerApp.id}" class="text-blue-600 hover:underline">${ownerApp.name}</a></td>
                                    <td class="p-4 text-gray-600 text-sm">${server.artifacts.length}</td>
                                </tr>
                            `}).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        };

        const renderServerDetail = (id) => {
             const server = getServerById(id);
            if (!server) {
                contentContainer.innerHTML = `<p>Servidor no encontrado.</p>`;
                return;
            }
            const ownerApp = getAppById(server.ownerApp);
            contentContainer.innerHTML = `
                 <div>
                    <a href="#/servers" class="text-sm text-blue-600 hover:underline">&larr; Volver a Servidores</a>
                    <h2 class="text-3xl font-bold mt-2">${server.name}</h2>
                    <p class="text-gray-600 mt-1">
                        Aplicación propietaria: <a href="#/application/${ownerApp.id}" class="font-medium text-blue-600 hover:underline">${ownerApp.name}</a>
                    </p>
                </div>
                <div class="mt-8 bg-white rounded-lg shadow">
                    <h3 class="text-lg font-semibold p-4 border-b">Artefactos Desplegados</h3>
                     <ul class="p-4 space-y-2">
                        ${server.artifacts.map(art => `
                            <li class="font-mono text-sm text-gray-700 bg-gray-100 p-2 rounded">${art}</li>
                        `).join('')}
                    </ul>
                </div>
            `;
        };


        // --- ROUTER ---
        const routes = {
            '/dashboard': renderDashboard,
            '/applications': renderApplications,
            '/application/:id': renderApplicationDetail,
            '/products': renderProducts,
            '/product/:id': renderProductDetail,
            '/servers': renderServers,
            '/server/:id': renderServerDetail,
            '/debt/:id': renderDebtDetail
        };

        const router = () => {
            const hash = location.hash.slice(1) || '/dashboard';
            const [path, id] = hash.split('/').slice(1);
            
            let routeHandler;
            let routeKey = `/${path}`;

            if(id) {
                routeKey += '/:id';
                routeHandler = routes[routeKey];
                if (routeHandler) {
                    routeHandler(id);
                } else {
                    contentContainer.innerHTML = `<p class="text-center text-red-500">404 - Ruta no encontrada</p>`;
                }
            } else {
                routeHandler = routes[routeKey];
                if(routeHandler) {
                    routeHandler();
                } else {
                     contentContainer.innerHTML = `<p class="text-center text-red-500">404 - Ruta no encontrada</p>`;
                }
            }
        };

        window.addEventListener('hashchange', router);
        window.addEventListener('load', () => {
            if (!location.hash) {
                location.hash = '#/dashboard';
            }
            router();
        });
    </script>
</body>
</html>
